# extracerts
Place under this directory any additional PEM-encoded (`.crt`) certificates
that you want to be included in the finalized new secure boot databases, which
will be generated by the `create-databases.sh`.

Any additional Key Exchange Key (KEK) certificates go under the `kek/`
subdirectory, and any additional Authorized Signature (db) certificates go
under the `db/` subdirectory. It is important that you put the certificates in
the correct subdirectory. See the [top-level README.md file](../README.md) for
more information about this. Note that the `create-databases.sh` searches the
two aforementioned subdirectories recursively, and ignores any files without a
`.crt` file extension.

Under the top-level directory of this repository, there is a folder named
`extracerts.DEFAULT/`. This contains some commonly desired certificates for
both KEK and db, which you may or may not want to include in your databases.
To start, you can copy this entire directory over by running the following
command (from the top-level directory of this repository):
```sh
cp -r extracerts.DEFAULT/{db,kek} extracerts
```

By default, this default set contains the Microsoft certificates for both KEK
and db, as well as the official db certificate of [MassOS](https://massos.org).
If any of these are undesired, you can remove some or all of them. However, we
recommend keeping at least the Microsoft db certificates, as they will be
required for booting Windows and some Microsoft-signed GNU/Linux distributions.
However, if you want to ensure you have full control over the system, and don't
want Microsoft to be able to supply updates to db and dbx themselves, then you
may safely delete the Microsoft KEK certificates. This would mean that only you
can authorize db and dbx updates. More information about why this distinction
matters can be found in the [top-level README.md file](../README.md). You can
also safely remove the MassOS db certificate if you have no plans to boot or
use MassOS GNU/Linux. MassOS also does not have a KEK certificate.

Some third party certificates may be distributed in the **DER** binary format,
instead of the default **PEM** format. Such certificates will instead use the
extension `.cer` or `.der`. You can use the OpenSSL command-line utility to
convert a **DER** certificate to a **PEM** one (replace `example` with the
actual name of the file):
```
openssl x509 -in example.der -inform DER -out example.crt -outform PEM
```

You may also wish to add OEM certificates for your device, which can be dumped
from your main system using the `dump-existing.sh` script, though this is only
required if some utility or function that is built-in to the firmware is signed
by such key. If this is not the case, you don't need OEM keys (and you probably
don't need to dump in the first place either, since most firmwares have a
"Restore Factory Keys" option). It should also be noted that `dump-existing.sh`
dumps ALL certificates, only one of which should be the OEM's own one. The
dumped certs will be placed in `dumped/KEK/crt` and `dumped/db/crt` for KEK and
db respectively. On any given `.crt` file, you can use the following command to
check which certificate it is:
```sh
openssl x509 -in NAME_OF_THE_CERTIFICATE_FILE.crt -noout -text
```
And look for the line containing something like the following output:
```sh
Subject: CN=Example OEM Certificate
```
And the CN should be the OEM's name, NOT "Microsoft" or "Windows". There may
also be other fields before CN, if the certificate also has physical address
information, but you can ignore this, and only take note of CN. Not all OEMs
will supply KEK or db keys, so you can ignore this entirely if this not the
case. But once you've found which `.crt` certificate corresponds to your OEM,
then you can copy it over to the `extracerts/` directory, again under the `db/`
or `kek/` subdirectory depending upon which type of certificate it is.

Here is an image showing the setup for an example system, with annotations to
help explain it:

![](../extracerts-layout-example.png)
